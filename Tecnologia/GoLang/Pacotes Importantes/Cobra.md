---
tags:
  - Tecnologia
  - GoLang
---
### üêç **Cobra: Criando CLIs poderosas no Go** üöÄ

O **Cobra** √© uma **biblioteca para criar [[CLI]]s (Command Line Interfaces)** no [[Go]] de forma organizada e profissional. Ele √© amplamente usado para criar ferramentas de linha de comando robustas, incluindo o pr√≥prio **kubectl (CLI do [[Kubernetes]])**.

---

## üî• **Por que usar Cobra ao inv√©s de `flag`?**

O pacote `flag` √© bom para CLIs simples, mas **Cobra** oferece vantagens como:
‚úÖ **Organiza√ß√£o modular** (comandos e subcomandos)  
‚úÖ **Autocompletar (bash, zsh, fish, etc.)**  
‚úÖ **Ajuda autom√°tica (`--help`)**  
‚úÖ **Facilidade para criar hierarquia de comandos**  
‚úÖ **Melhor estrutura√ß√£o para CLIs grandes**

---

## üîß **Instala√ß√£o do Cobra**

Para usar o **Cobra**, primeiro instale-o no seu projeto:

```sh
go get -u github.com/spf13/cobra@latest
go get -u github.com/spf13/cobra/cobra@latest
```

---

## üìå **Exemplo 1: CLI b√°sica com Cobra**

Criaremos um CLI simples que imprime `"Ol√°, Jean!"`.

### üîπ Criando o arquivo `main.go`

```go
package main

import (
	"fmt"
	"github.com/spf13/cobra"
)

func main() {
	// Criando o comando root
	var rootCmd = &cobra.Command{
		Use:   "app",
		Short: "Meu CLI com Cobra",
		Run: func(cmd *cobra.Command, args []string) {
			fmt.Println("Ol√°, Jean!")
		},
	}

	// Executando o comando root
	rootCmd.Execute()
}
```

### üîπ Como rodar:

```sh
go run main.go
```

### üîπ Sa√≠da:

```
Ol√°, Jean!
```

üî• **J√° temos uma CLI funcional!**  
E automaticamente, ele j√° suporta `--help`:

```sh
go run main.go --help
```

### üîπ Sa√≠da:

```
Meu CLI com Cobra

Usage:
  app [flags]

Flags:
  -h, --help   help for app
```

---

## üìå **Exemplo 2: Adicionando flags**

Agora, vamos permitir que o usu√°rio passe um nome como argumento.

```go
package main

import (
	"fmt"
	"github.com/spf13/cobra"
)

func main() {
	var nome string

	var rootCmd = &cobra.Command{
		Use:   "app",
		Short: "Meu CLI com Cobra",
		Run: func(cmd *cobra.Command, args []string) {
			fmt.Printf("Ol√°, %s!\n", nome)
		},
	}

	// Adicionando flag --nome
	rootCmd.Flags().StringVarP(&nome, "nome", "n", "Usu√°rio", "Nome da pessoa")

	rootCmd.Execute()
}
```

### üîπ Como rodar:

```sh
go run main.go --nome=Jean
```

### üîπ Sa√≠da:

```
Ol√°, Jean!
```

---

## üìå **Exemplo 3: Criando subcomandos**

Uma das maiores vantagens do **Cobra** √© a facilidade para criar **subcomandos**.

Vamos criar uma CLI que tenha um comando `saudar` e um comando `despedir`.

```go
package main

import (
	"fmt"
	"github.com/spf13/cobra"
)

func main() {
	var rootCmd = &cobra.Command{Use: "app"}

	var cmdSaudar = &cobra.Command{
		Use:   "saudar",
		Short: "Sauda um usu√°rio",
		Run: func(cmd *cobra.Command, args []string) {
			fmt.Println("Ol√°, bem-vindo!")
		},
	}

	var cmdDespedir = &cobra.Command{
		Use:   "despedir",
		Short: "Se despede do usu√°rio",
		Run: func(cmd *cobra.Command, args []string) {
			fmt.Println("Adeus, at√© a pr√≥xima!")
		},
	}

	// Adicionando subcomandos
	rootCmd.AddCommand(cmdSaudar, cmdDespedir)

	rootCmd.Execute()
}
```

### üîπ Como rodar:

```sh
go run main.go saudar
```

### üîπ Sa√≠da:

```
Ol√°, bem-vindo!
```

```sh
go run main.go despedir
```

### üîπ Sa√≠da:

```
Adeus, at√© a pr√≥xima!
```

üî• **Os subcomandos organizam melhor o c√≥digo e facilitam a expans√£o da CLI!**

---

## üìå **Exemplo 4: Autocompletar comandos**

Cobra tem suporte a **autocompletar** em shells como Bash e Zsh.

Para gerar o autocompletar:

```go
var completionCmd = &cobra.Command{
	Use:   "completion",
	Short: "Gera script de autocompletar para o shell",
	Run: func(cmd *cobra.Command, args []string) {
		cmd.Root().GenBashCompletion(os.Stdout)
	},
}
rootCmd.AddCommand(completionCmd)
```

Agora, rodamos:

```sh
go run main.go completion > autocomplete.sh
source autocomplete.sh
```

Agora, ao digitar:

```sh
go run main.go <TAB>
```

Ele sugere os comandos automaticamente. üöÄ

---


O **Cobra** √© uma **ferramenta poderosa para criar CLIs no Go**!  
Ele facilita a organiza√ß√£o, modulariza√ß√£o e adi√ß√£o de recursos como: ‚úÖ Subcomandos  
‚úÖ Flags  
‚úÖ Autocompletar  
‚úÖ Ajuda autom√°tica

Se voc√™ precisar criar **CLIs profissionais**, Cobra √© a escolha certa. üí™üî•

Bora um exemplo mais avan√ßado, tipo um CLI que chama uma API? üòÉ

### üöÄ **Criando um CLI que consome uma API com Cobra** üêç

Vamos construir um **CLI em Go usando Cobra** que faz requisi√ß√µes HTTP para uma API p√∫blica e exibe os dados no terminal.

---

## üìå **O que vamos fazer?**

Criar um CLI chamado `app` que:

1. **Busca informa√ß√µes sobre um usu√°rio do GitHub** atrav√©s da API do GitHub.
2. **Permite buscar reposit√≥rios p√∫blicos do usu√°rio**.
3. **Permite formatar a sa√≠da como JSON ou texto**.

---

## üîß **Passo 1: Instalar Depend√™ncias**

Antes de come√ßar, instale o Cobra:

```sh
go get -u github.com/spf13/cobra@latest
go get -u github.com/spf13/cobra/cobra@latest
```

Tamb√©m precisaremos do pacote `net/http` e `encoding/json`, que j√° fazem parte da biblioteca padr√£o do Go.

---

## üìú **C√≥digo do CLI com Cobra**

```go
package main

import (
	"encoding/json"
	"fmt"
	"io/ioutil"
	"net/http"
	"os"

	"github.com/spf13/cobra"
)

// Estrutura para armazenar os dados do usu√°rio do GitHub
type GitHubUser struct {
	Login     string `json:"login"`
	Name      string `json:"name"`
	Followers int    `json:"followers"`
	Following int    `json:"following"`
	PublicRepos int  `json:"public_repos"`
}

// Estrutura para armazenar os dados dos reposit√≥rios
type GitHubRepo struct {
	Name string `json:"name"`
	URL  string `json:"html_url"`
}

func main() {
	var outputFormat string

	// Comando principal
	var rootCmd = &cobra.Command{
		Use:   "app",
		Short: "CLI para buscar informa√ß√µes do GitHub",
	}

	// Comando para buscar usu√°rio
	var userCmd = &cobra.Command{
		Use:   "user [username]",
		Short: "Busca informa√ß√µes sobre um usu√°rio do GitHub",
		Args:  cobra.ExactArgs(1),
		Run: func(cmd *cobra.Command, args []string) {
			username := args[0]
			user, err := fetchGitHubUser(username)
			if err != nil {
				fmt.Println("Erro ao buscar usu√°rio:", err)
				return
			}

			if outputFormat == "json" {
				printJSON(user)
			} else {
				fmt.Printf("Nome: %s\nUsu√°rio: %s\nSeguidores: %d\nSeguindo: %d\nReposit√≥rios P√∫blicos: %d\n",
					user.Name, user.Login, user.Followers, user.Following, user.PublicRepos)
			}
		},
	}

	// Comando para buscar reposit√≥rios
	var reposCmd = &cobra.Command{
		Use:   "repos [username]",
		Short: "Lista os reposit√≥rios p√∫blicos de um usu√°rio",
		Args:  cobra.ExactArgs(1),
		Run: func(cmd *cobra.Command, args []string) {
			username := args[0]
			repos, err := fetchGitHubRepos(username)
			if err != nil {
				fmt.Println("Erro ao buscar reposit√≥rios:", err)
				return
			}

			if outputFormat == "json" {
				printJSON(repos)
			} else {
				fmt.Println("Reposit√≥rios P√∫blicos:")
				for _, repo := range repos {
					fmt.Printf("- %s (%s)\n", repo.Name, repo.URL)
				}
			}
		},
	}

	// Adiciona a flag de formato de sa√≠da
	userCmd.Flags().StringVarP(&outputFormat, "output", "o", "text", "Formato da sa√≠da (text/json)")
	reposCmd.Flags().StringVarP(&outputFormat, "output", "o", "text", "Formato da sa√≠da (text/json)")

	// Adiciona os comandos ao CLI
	rootCmd.AddCommand(userCmd, reposCmd)

	// Executa o CLI
	rootCmd.Execute()
}

// Fun√ß√£o para buscar informa√ß√µes do usu√°rio do GitHub
func fetchGitHubUser(username string) (GitHubUser, error) {
	url := fmt.Sprintf("https://api.github.com/users/%s", username)
	resp, err := http.Get(url)
	if err != nil {
		return GitHubUser{}, err
	}
	defer resp.Body.Close()

	if resp.StatusCode != http.StatusOK {
		return GitHubUser{}, fmt.Errorf("usu√°rio n√£o encontrado")
	}

	body, err := ioutil.ReadAll(resp.Body)
	if err != nil {
		return GitHubUser{}, err
	}

	var user GitHubUser
	if err := json.Unmarshal(body, &user); err != nil {
		return GitHubUser{}, err
	}

	return user, nil
}

// Fun√ß√£o para buscar reposit√≥rios do GitHub
func fetchGitHubRepos(username string) ([]GitHubRepo, error) {
	url := fmt.Sprintf("https://api.github.com/users/%s/repos", username)
	resp, err := http.Get(url)
	if err != nil {
		return nil, err
	}
	defer resp.Body.Close()

	if resp.StatusCode != http.StatusOK {
		return nil, fmt.Errorf("usu√°rio n√£o encontrado")
	}

	body, err := ioutil.ReadAll(resp.Body)
	if err != nil {
		return nil, err
	}

	var repos []GitHubRepo
	if err := json.Unmarshal(body, &repos); err != nil {
		return nil, err
	}

	return repos, nil
}

// Fun√ß√£o auxiliar para imprimir JSON formatado
func printJSON(data interface{}) {
	result, err := json.MarshalIndent(data, "", "  ")
	if err != nil {
		fmt.Println("Erro ao formatar JSON:", err)
		return
	}
	fmt.Println(string(result))
}
```

---

## üéØ **Como usar o CLI?**

### üîπ **Buscar informa√ß√µes de um usu√°rio**

```sh
go run main.go user JeanGrijp
```

üîπ **Sa√≠da:**

```
Nome: Jean Grijp
Usu√°rio: JeanGrijp
Seguidores: 200
Seguindo: 150
Reposit√≥rios P√∫blicos: 50
```

Ou em **JSON**:

```sh
go run main.go user JeanGrijp --output=json
```

üîπ **Sa√≠da JSON formatada:**

```json
{
  "login": "JeanGrijp",
  "name": "Jean Grijp",
  "followers": 200,
  "following": 150,
  "public_repos": 50
}
```

---

### üîπ **Buscar reposit√≥rios de um usu√°rio**

```sh
go run main.go repos JeanGrijp
```

üîπ **Sa√≠da:**

```
Reposit√≥rios P√∫blicos:
- meu-projeto (https://github.com/JeanGrijp/meu-projeto)
- app-teste (https://github.com/JeanGrijp/app-teste)
```

Ou em JSON:

```sh
go run main.go repos JeanGrijp --output=json
```

üîπ **Sa√≠da JSON formatada:**

```json
[
  {
    "name": "meu-projeto",
    "url": "https://github.com/JeanGrijp/meu-projeto"
  },
  {
    "name": "app-teste",
    "url": "https://github.com/JeanGrijp/app-teste"
  }
]
```

---

## üöÄ **O que aprendemos?**

‚úÖ Criamos um **CLI modular** com o **Cobra**  
‚úÖ Fizemos **requisi√ß√µes HTTP** para uma API p√∫blica  
‚úÖ Usamos **flags para personalizar a sa√≠da** (texto ou JSON)  
‚úÖ Criamos **comandos e subcomandos** (`user` e `repos`)

Este √© um **exemplo pr√°tico** de como criar uma ferramenta de linha de comando √∫til! üí™üî•

Quer adicionar autentica√ß√£o via **GitHub Token** ou salvar os dados em um arquivo? üòÉ